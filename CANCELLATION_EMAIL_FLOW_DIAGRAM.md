# Booking Cancellation Email Flow Diagram

## System Architecture Overview

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        Guest User Interface                          â”‚
â”‚                        (My Bookings Page)                            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
             â”‚
             â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
             â”‚                                 â”‚                      â”‚
             â–¼                                 â–¼                      â–¼
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚  Pending Status â”‚          â”‚ Confirmed Statusâ”‚     â”‚  Cancelled   â”‚
    â”‚  (Can Cancel)   â”‚          â”‚  (Can Refund)   â”‚     â”‚   Already    â”‚
    â”‚                 â”‚          â”‚                 â”‚     â”‚              â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜          â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
             â”‚                           â”‚
             â”‚ Click "Cancel Booking"    â”‚ Click "Request Refund"
             â”‚                           â”‚
             â–¼                           â–¼
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚ Confirmation Modal     â”‚  â”‚ Confirmation Modal     â”‚
    â”‚ (Pending Cancellation) â”‚  â”‚ (Refund Request)       â”‚
    â”‚                        â”‚  â”‚                        â”‚
    â”‚ "Confirm Cancel"  â”€â”€â”  â”‚  â”‚ Refund: â‚±X.XX    â”€â”€â”  â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”˜  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”˜  â”‚
              â”‚          â”‚    â”‚           â”‚          â”‚    â”‚
              â”‚ Cancel   â”‚ Keep          â”‚ Cancel   â”‚ Keep
              â”‚ Booking  â”‚ Booking       â”‚ Refund   â”‚ Booking
              â”‚          â”‚               â”‚          â”‚
              â–¼          â”‚               â–¼          â”‚
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚  handleCancelBooking() / handleRefund()             â”‚
    â”‚  (src/components/MyBookings.jsx)                    â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                       â”‚
         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
         â”‚             â”‚              â”‚              â”‚
         â–¼             â–¼              â–¼              â–¼
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚ Delete  â”‚  â”‚ Update   â”‚   â”‚ Update   â”‚   â”‚   Create    â”‚
    â”‚ Booking â”‚  â”‚ Guest    â”‚   â”‚  Host    â”‚   â”‚ Transactionsâ”‚
    â”‚ Firestore   â”‚Wallet   â”‚   â”‚ Wallet   â”‚   â”‚             â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚             â”‚              â”‚              â”‚
         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                       â”‚
         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
         â”‚                            â”‚
         â”‚  sendBookingCancellation   â”‚
         â”‚  Email()                   â”‚
         â”‚                            â”‚
         â”‚  (src/utils/)              â”‚
         â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                  â”‚
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚                   â”‚
        â–¼                   â–¼
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚   Primary    â”‚   â”‚   Fallback   â”‚
    â”‚  EmailJS     â”‚â”€â”€â–¶â”‚   EmailJS    â”‚
    â”‚  Service     â”‚   â”‚  Service     â”‚
    â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
           â”‚                  â”‚
           â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
                      â”‚
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚                            â”‚
        â”‚    Email Template Render   â”‚
        â”‚    (EmailJS Service)       â”‚
        â”‚                            â”‚
        â”‚  Uses Variables:           â”‚
        â”‚  - guestName               â”‚
        â”‚  - listingTitle            â”‚
        â”‚  - basePrice               â”‚
        â”‚  - refundAmount            â”‚
        â”‚  - cancellationReason      â”‚
        â”‚  ... + 20 more             â”‚
        â”‚                            â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                      â”‚
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚                            â”‚
        â”‚  HTML Email Template       â”‚
        â”‚  (public/booking-          â”‚
        â”‚   cancellation-email.html) â”‚
        â”‚                            â”‚
        â”‚  Renders:                  â”‚
        â”‚  - Cancellation Header     â”‚
        â”‚  - Booking Details         â”‚
        â”‚  - Refund Info (if any)    â”‚
        â”‚  - Timeline                â”‚
        â”‚  - Next Steps              â”‚
        â”‚  - Footer                  â”‚
        â”‚                            â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                      â”‚
                      â–¼
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚   SMTP Server            â”‚
        â”‚   (EmailJS/Brevo)        â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                       â”‚
                       â–¼
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚   Guest Email Inbox      â”‚
        â”‚   (guest@email.com)      â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

```

---

## Detailed Flow: Pending Booking Cancellation

```
GUEST INITIATES CANCELLATION
        â”‚
        â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ My Bookings Page                 â”‚
â”‚ - Display all guest bookings     â”‚
â”‚ - Show booking cards with status â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                 â”‚
                 â”‚ Click booking card
                 â–¼
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚ Booking Details    â”‚
        â”‚ Modal              â”‚
        â”‚                    â”‚
        â”‚ Status: PENDING    â”‚
        â”‚ Price: â‚±1,000      â”‚
        â”‚                    â”‚
        â”‚ [Cancel Booking]   â”‚â—€â”€â”€â”€ Button
        â”‚ [View Listing]     â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                 â”‚
                 â”‚ Click "Cancel Booking"
                 â–¼
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚ Confirmation Modal      â”‚
        â”‚                         â”‚
        â”‚ "Cancel Booking?"       â”‚
        â”‚                         â”‚
        â”‚ "Are you sure you want  â”‚
        â”‚  to cancel this         â”‚
        â”‚  booking?"              â”‚
        â”‚                         â”‚
        â”‚ Booking: Villa Beachfront
        â”‚ Check-in: Dec 15, 2025  â”‚
        â”‚                         â”‚
        â”‚ [Keep Booking]          â”‚
        â”‚ [Confirm Cancel]â—€â”€â”€â”€â”€â”€â”€ Click to confirm
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                 â”‚
                 â”‚ Confirm Cancel clicked
                 â–¼
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚ handleCancelBooking()  â”‚
        â”‚                        â”‚
        â”‚ 1. Delete booking      â”‚
        â”‚    from Firestore      â”‚
        â”‚ 2. Update local state  â”‚
        â”‚ 3. Send email (async)  â”‚
        â”‚ 4. Show success toast  â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                 â”‚
                 â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                 â”‚ (Happens in background)         â”‚
                 â–¼                                 â”‚
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”          â”‚
        â”‚ sendBookingCancellation      â”‚          â”‚
        â”‚ Email()                      â”‚          â”‚
        â”‚                              â”‚          â”‚
        â”‚ Parameters:                  â”‚          â”‚
        â”‚ - booking                    â”‚          â”‚
        â”‚ - guestData                  â”‚          â”‚
        â”‚ - options:                   â”‚          â”‚
        â”‚   - cancellationReason:      â”‚          â”‚
        â”‚     "Booking cancelled by    â”‚          â”‚
        â”‚      guest"                  â”‚          â”‚
        â”‚   - basePrice: 1000          â”‚          â”‚
        â”‚   - refundAmount: 0          â”‚          â”‚
        â”‚                              â”‚          â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜          â”‚
                 â”‚                                â”‚
         â”Œâ”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”                       â”‚
         â”‚                â”‚                       â”‚
         â–¼                â–¼                       â”‚
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                â”‚
    â”‚ Primary  â”‚     â”‚ Fallback â”‚                â”‚
    â”‚ Service  â”‚     â”‚ Service  â”‚                â”‚
    â”‚ (Success)â”‚     â”‚ (if fail)â”‚                â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                â”‚
         â”‚                â”‚                       â”‚
         â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜                       â”‚
                  â”‚                               â”‚
                  â–¼                               â”‚
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                  â”‚
        â”‚ Email Sent to Guest â”‚â—€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
        â”‚                     â”‚                  â”‚
        â”‚ Subject: Booking    â”‚    Toast Success â”‚
        â”‚ Cancelled           â”‚    (shown to UI) â”‚
        â”‚                     â”‚                  â”‚
        â”‚ Content:            â”‚                  â”‚
        â”‚ - Cancellation      â”‚                  â”‚
        â”‚   confirmed         â”‚                  â”‚
        â”‚ - Booking details   â”‚                  â”‚
        â”‚ - No refund         â”‚                  â”‚
        â”‚   (pending status)  â”‚                  â”‚
        â”‚ - Dashboard link    â”‚                  â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                  â”‚
                                                 â”‚
                                                 â–¼
                                        Modal closes
                                        Page refreshes
                                        Booking removed
```

---

## Detailed Flow: Confirmed Booking Refund

```
GUEST INITIATES REFUND
        â”‚
        â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ My Bookings Page                 â”‚
â”‚ - Display confirmed bookings     â”‚
â”‚ - Check-in date: FUTURE          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                 â”‚
                 â”‚ Click booking card
                 â–¼
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚ Booking Details    â”‚
        â”‚ Modal              â”‚
        â”‚                    â”‚
        â”‚ Status: CONFIRMED  â”‚
        â”‚ Price: â‚±5,000      â”‚
        â”‚ Check-in: Dec 15   â”‚
        â”‚                    â”‚
        â”‚ âš ï¸ You can request â”‚
        â”‚ refund             â”‚
        â”‚                    â”‚
        â”‚ [Request Refund]   â”‚â—€â”€â”€â”€ Button (enabled)
        â”‚ [View Listing]     â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                 â”‚
                 â”‚ Click "Request Refund"
                 â–¼
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚ Refund Confirmation Modal  â”‚
        â”‚                            â”‚
        â”‚ "Request Refund?"          â”‚
        â”‚                            â”‚
        â”‚ Booking: Beachfront Villa  â”‚
        â”‚ Check-in: Dec 15, 2025     â”‚
        â”‚ Refund Amount: â‚±5,000      â”‚
        â”‚                            â”‚
        â”‚ "Are you sure you want to  â”‚
        â”‚  cancel this booking and   â”‚
        â”‚  request a refund?"        â”‚
        â”‚                            â”‚
        â”‚ â„¹ï¸ Refund processed        â”‚
        â”‚    immediately to wallet   â”‚
        â”‚                            â”‚
        â”‚ [Keep Booking]             â”‚
        â”‚ [Confirm Refund]â—€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ Click to confirm
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                 â”‚
                 â”‚ Confirm Refund clicked
                 â–¼
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚ handleRefund()            â”‚
        â”‚                           â”‚
        â”‚ 1. Check check-in date    â”‚
        â”‚    (must be future)       â”‚
        â”‚ 2. Get guest wallet       â”‚
        â”‚ 3. Get host wallet        â”‚
        â”‚ 4. Update guest wallet    â”‚
        â”‚    (add refund â‚±5,000)    â”‚
        â”‚ 5. Update host wallet     â”‚
        â”‚    (deduct â‚±5,000)        â”‚
        â”‚ 6. Create transactions    â”‚
        â”‚    (for accounting)       â”‚
        â”‚ 7. Remove booked dates    â”‚
        â”‚    from listing           â”‚
        â”‚ 8. Delete booking         â”‚
        â”‚ 9. Send email (async)     â”‚
        â”‚ 10. Show success toast    â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                 â”‚
    Wallet Changes â”‚ (happens first)
                 â”‚
         â”Œâ”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
         â”‚                   â”‚
         â–¼                   â–¼
    Guest Wallet       Host Wallet
    â‚±X,XXX â”€â”€â”€â”€â”€â”€â”€â”€â–¶ â‚±Y,YYY - â‚±5,000
    (increased)      (decreased)
                 â”‚
                 â”‚ Then send email in background
                 â–¼
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚ sendBookingCancellation      â”‚
        â”‚ Email()                      â”‚
        â”‚                              â”‚
        â”‚ Parameters:                  â”‚
        â”‚ - booking                    â”‚
        â”‚ - guestData                  â”‚
        â”‚ - options:                   â”‚
        â”‚   - cancellationReason:      â”‚
        â”‚     "Booking cancelled by    â”‚
        â”‚      guest"                  â”‚
        â”‚   - basePrice: 5000          â”‚
        â”‚   - serviceFee: 250 (5%)     â”‚
        â”‚   - refundAmount: 5000       â”‚
        â”‚                              â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                 â”‚
         â”Œâ”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”
         â”‚                â”‚
         â–¼                â–¼
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚ Primary  â”‚     â”‚ Fallback â”‚
    â”‚ Service  â”‚     â”‚ Service  â”‚
    â”‚ (Success)â”‚     â”‚ (if fail)â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚                â”‚
         â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
                  â”‚
                  â–¼
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚ Email Sent to Guest â”‚
        â”‚                     â”‚
        â”‚ Subject: Booking    â”‚
        â”‚ Cancelled - Refund  â”‚
        â”‚ Processed           â”‚
        â”‚                     â”‚
        â”‚ Content:            â”‚
        â”‚ - Cancellation      â”‚
        â”‚   confirmed         â”‚
        â”‚ - Booking details   â”‚
        â”‚ - Refund Amount:    â”‚
        â”‚   â‚±5,000            â”‚
        â”‚ - Service Fee:      â”‚
        â”‚   â‚±250 (incl.)      â”‚
        â”‚ - Timeline:         â”‚
        â”‚   24-48 hours       â”‚
        â”‚ - e-wallet info     â”‚
        â”‚ - Dashboard link    â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

                 â–¼
        Modal closes
        Page refreshes
        Booking removed
        Wallet updated
```

---

## Email Template Rendering

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚     sendBookingCancellationEmail()          â”‚
â”‚     Prepares Parameters                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                 â”‚
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚ Email Parameters Object:  â”‚
    â”‚                           â”‚
    â”‚ to_email:                 â”‚
    â”‚  "guest@example.com"      â”‚
    â”‚ guestName:                â”‚
    â”‚  "John Doe"               â”‚
    â”‚ listingTitle:             â”‚
    â”‚  "Beachfront Villa"       â”‚
    â”‚ listingLocation:          â”‚
    â”‚  "Boracay, Philippines"   â”‚
    â”‚ listingType:              â”‚
    â”‚  "Stays"                  â”‚
    â”‚ basePrice:                â”‚
    â”‚  "5000.00"                â”‚
    â”‚ serviceFee:               â”‚
    â”‚  "250.00"                 â”‚
    â”‚ refundAmount:             â”‚
    â”‚  "5000.00"                â”‚
    â”‚ cancellationDate:         â”‚
    â”‚  "Oct 29, 2025"           â”‚
    â”‚ bookingType:              â”‚
    â”‚  "stays"                  â”‚
    â”‚ checkInDate:              â”‚
    â”‚  "Dec 15, 2025"           â”‚
    â”‚ checkOutDate:             â”‚
    â”‚  "Dec 20, 2025"           â”‚
    â”‚ numberOfNights:           â”‚
    â”‚  "5"                      â”‚
    â”‚ ... (and more)            â”‚
    â”‚                           â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                 â”‚
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚ EmailJS sends to template     â”‚
    â”‚ Template ID:                  â”‚
    â”‚ VITE_CANCELED_EMAIL_JS_       â”‚
    â”‚ TEMPLATE_ID                   â”‚
    â”‚ Service ID:                   â”‚
    â”‚ VITE_EMAIL_JS_SERVICE_ID      â”‚
    â”‚                               â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                 â”‚
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚ Template Engine renders HTML:     â”‚
    â”‚ (Handlebars template processing)  â”‚
    â”‚                                   â”‚
    â”‚ {{{guestName}}} â†’ John Doe       â”‚
    â”‚ {{{listingTitle}}} â†’ Beachfront  â”‚
    â”‚  Villa                           â”‚
    â”‚ {{{refundAmount}}} â†’ â‚±5000.00    â”‚
    â”‚ {{#if bookingType==='stays'}}   â”‚
    â”‚   â†’ Shows check-in/out dates    â”‚
    â”‚ {{/if}}                         â”‚
    â”‚                                   â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                 â”‚
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚ Final HTML Email Output:          â”‚
    â”‚                                   â”‚
    â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
    â”‚ â”‚ [BookingNest Logo]           â”‚  â”‚
    â”‚ â”‚                              â”‚  â”‚
    â”‚ â”‚ Booking Cancelled            â”‚  â”‚
    â”‚ â”‚                              â”‚  â”‚
    â”‚ â”‚ Hi John Doe,                 â”‚  â”‚
    â”‚ â”‚                              â”‚  â”‚
    â”‚ â”‚ Cancellation Details         â”‚  â”‚
    â”‚ â”‚                              â”‚  â”‚
    â”‚ â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚  â”‚
    â”‚ â”‚ â”‚ Beachfront Villa         â”‚ â”‚  â”‚
    â”‚ â”‚ â”‚ ğŸ“ Boracay, Philippines  â”‚ â”‚  â”‚
    â”‚ â”‚ â”‚ â­ 4.8 stars             â”‚ â”‚  â”‚
    â”‚ â”‚ â”‚ [Stays]                  â”‚ â”‚  â”‚
    â”‚ â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚  â”‚
    â”‚ â”‚                              â”‚  â”‚
    â”‚ â”‚ Booking Details             â”‚  â”‚
    â”‚ â”‚ Check-in: Dec 15, 2025      â”‚  â”‚
    â”‚ â”‚ Check-out: Dec 20, 2025     â”‚  â”‚
    â”‚ â”‚ Nights: 5                    â”‚  â”‚
    â”‚ â”‚ Guests: 2                    â”‚  â”‚
    â”‚ â”‚ Date: Oct 29, 2025           â”‚  â”‚
    â”‚ â”‚                              â”‚  â”‚
    â”‚ â”‚ Refund Information           â”‚  â”‚
    â”‚ â”‚ Amount: â‚±5,000               â”‚  â”‚
    â”‚ â”‚ Fee: â‚±250                    â”‚  â”‚
    â”‚ â”‚ TOTAL: â‚±5,000                â”‚  â”‚
    â”‚ â”‚                              â”‚  â”‚
    â”‚ â”‚ Timeline                     â”‚  â”‚
    â”‚ â”‚ âœ“ Processed                  â”‚  â”‚
    â”‚ â”‚ â±ï¸ 24-48 hours pending       â”‚  â”‚
    â”‚ â”‚ ğŸ’° Check wallet              â”‚  â”‚
    â”‚ â”‚                              â”‚  â”‚
    â”‚ â”‚ [View Booking History]       â”‚  â”‚
    â”‚ â”‚                              â”‚  â”‚
    â”‚ â”‚ Footer                       â”‚  â”‚
    â”‚ â”‚ Â© 2025 BookingNest           â”‚  â”‚
    â”‚ â”‚                              â”‚  â”‚
    â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
    â”‚                                   â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                 â”‚
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚ Send via SMTP                     â”‚
    â”‚ (EmailJS Provider)                â”‚
    â”‚ To: guest@example.com             â”‚
    â”‚                                   â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                 â”‚
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚ Guest Inbox                       â”‚
    â”‚                                   â”‚
    â”‚ From: noreply@bookingnest.com     â”‚
    â”‚ Subject: Booking Cancelled        â”‚
    â”‚ Received: Oct 29, 2025 10:30 AM   â”‚
    â”‚                                   â”‚
    â”‚ âœ“ Read                            â”‚
    â”‚                                   â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## Error Handling Flow

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ sendBookingCancellationEmail()        â”‚
â”‚ Execute email sending                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
             â”‚
             â–¼
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚ EmailJS Primary    â”‚
    â”‚ Service Send       â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
             â”‚
        â”Œâ”€â”€â”€â”€â”´â”€â”€â”€â”€â”
        â”‚          â”‚
        â–¼          â–¼
    SUCCESS   FAILURE
        â”‚          â”‚
        â”‚          â–¼
        â”‚      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚      â”‚ Log Error âŒ        â”‚
        â”‚      â”‚ Try Fallback        â”‚
        â”‚      â”‚ Service             â”‚
        â”‚      â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
        â”‚               â”‚
        â”‚               â–¼
        â”‚      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚      â”‚ EmailJS Fallback    â”‚
        â”‚      â”‚ Service Send        â”‚
        â”‚      â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
        â”‚               â”‚
        â”‚          â”Œâ”€â”€â”€â”€â”´â”€â”€â”€â”€â”
        â”‚          â”‚          â”‚
        â”‚          â–¼          â–¼
        â”‚      SUCCESS   FAILURE
        â”‚          â”‚          â”‚
        â”‚          â”‚          â–¼
        â”‚          â”‚      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚          â”‚      â”‚ Log Error âŒ â”‚
        â”‚          â”‚      â”‚ Continue     â”‚
        â”‚          â”‚      â”‚ without emailâ”‚
        â”‚          â”‚      â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
        â”‚          â”‚             â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                   â”‚
                   â–¼
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚ Email Success âœ…            â”‚
    â”‚ (either service)            â”‚
    â”‚                             â”‚
    â”‚ Return to calling function: â”‚
    â”‚ - handleCancelBooking()     â”‚
    â”‚ - handleRefund()            â”‚
    â”‚                             â”‚
    â”‚ Booking/Refund is complete  â”‚
    â”‚ Email sent successfully     â”‚
    â”‚ Show success toast          â”‚
    â”‚                             â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

OR

    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚ Email Failed âŒ             â”‚
    â”‚ (both services)             â”‚
    â”‚                             â”‚
    â”‚ Return to calling function: â”‚
    â”‚ - handleCancelBooking()     â”‚
    â”‚ - handleRefund()            â”‚
    â”‚                             â”‚
    â”‚ Booking/Refund IS STILL    â”‚
    â”‚ COMPLETED!                  â”‚
    â”‚ Email failed gracefully     â”‚
    â”‚ Show success toast anyway   â”‚
    â”‚ (wallet already updated)    â”‚
    â”‚                             â”‚
    â”‚ User can check email later  â”‚
    â”‚ or contact support          â”‚
    â”‚                             â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## Key Points

1. **Asynchronous**: Email sending happens in background (doesn't block UI)
2. **Graceful Degradation**: Email failures don't affect core functionality
3. **Type-Aware**: Email content adapts based on booking type
4. **Comprehensive**: Full refund details in email
5. **Logged**: All actions logged to console for debugging
6. **Professional**: HTML template with branding and styling
7. **Tested**: Test utilities available for verification

